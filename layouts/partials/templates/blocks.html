{{ .Scratch.Set "sections" slice }}
<ul id="markdown-toc">
{{ range .Scratch.Get "blocks" }}
{{ $section := (partial "templates/block" .) }}
{{ $headers := findRE "<h2.*?>(.|\n)*?</h2>" $section }}
{{ range $headers }}
{{ $header := . | replaceRE "</?h2.*?>" "" | htmlUnescape }}
<li><a href="#{{ $header | anchorize }}">{{ $header }}</a></li>
{{ end }}
{{ $.Scratch.Add "sections" $section }}
{{ end }}
</ul>
{{ range .Scratch.Get "sections" }}
{{ . }}
{{ end }}